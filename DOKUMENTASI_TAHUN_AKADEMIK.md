# ğŸ“… Sistem Tahun Akademik Otomatis AR-Hafalan

## ğŸ¯ Overview
Sistem tahun akademik otomatis yang mengikuti kalender umum dengan pembagian semester:
- **Semester 1 (S1)**: Juli - Desember 
- **Semester 2 (S2)**: Januari - Juni

## ğŸš€ Fitur Utama

### 1. Auto-Generate Tahun Akademik
- Generate otomatis berdasarkan rentang tahun
- Preview sebelum generate
- Auto-set tahun akademik saat ini sebagai aktif

### 2. Manajemen Tahun Akademik
- CRUD tahun akademik manual
- Set tahun akademik aktif
- Statistik data per tahun akademik

### 3. Auto-Inject ke Semua Data
- Semua data otomatis tersimpan dengan tahun akademik yang sesuai
- Filter data berdasarkan tahun akademik
- Konsistensi data across modules

## ğŸ“ Struktur File

### Utilities
- `lib/tahun-akademik-utils.ts` - Core utilities untuk kalkulasi tahun akademik
- `lib/tahun-akademik-middleware.ts` - Middleware untuk auto-inject tahun akademik
- `hooks/use-tahun-akademik.ts` - React hooks untuk tahun akademik

### API Endpoints
- `GET /api/admin/tahun-akademik` - List semua tahun akademik
- `POST /api/admin/tahun-akademik` - Buat tahun akademik baru
- `GET /api/admin/tahun-akademik/active` - Get tahun akademik aktif
- `POST /api/admin/tahun-akademik/active` - Set tahun akademik aktif
- `GET /api/admin/tahun-akademik/auto-generate` - Preview auto-generate
- `POST /api/admin/tahun-akademik/auto-generate` - Execute auto-generate

### Components
- `components/admin/tahun-akademik/AutoGenerateDialog.tsx` - Dialog auto-generate
- `components/admin/tahun-akademik/TahunAkademikSelector.tsx` - Selector tahun akademik
- `app/(dashboard)/admin/tahun-akademik/page.tsx` - Halaman manajemen

## ğŸ”§ Cara Penggunaan

### 1. Auto-Generate Tahun Akademik
```typescript
// Preview
const preview = await fetch('/api/admin/tahun-akademik/auto-generate?startYear=2024&endYear=2025')

// Generate
const result = await fetch('/api/admin/tahun-akademik/auto-generate', {
  method: 'POST',
  body: JSON.stringify({
    startYear: 2024,
    endYear: 2025,
    autoSetActive: true
  })
})
```

### 2. Menggunakan Hook
```typescript
import { useTahunAkademik, useTahunAkademikContext } from '@/hooks/use-tahun-akademik'

function MyComponent() {
  const { activeTahunAkademik, setActiveTahunAkademik } = useTahunAkademik()
  const { tahunAjaranId } = useTahunAkademikContext()
  
  // Filter data berdasarkan tahun akademik aktif
  const filteredData = data.filter(item => item.tahunAjaranId === tahunAjaranId)
}
```

### 3. Auto-Inject Tahun Akademik
```typescript
import { withTahunAkademik } from '@/lib/tahun-akademik-middleware'

// Saat menyimpan data
const dataWithTahunAkademik = await withTahunAkademik({
  // data lainnya
})

await prisma.ujianSantri.create({
  data: dataWithTahunAkademik
})
```

## ğŸ“Š Sistem Kalender

### Semester 1 (Juli - Desember)
- **Periode**: 1 Juli - 31 Desember
- **Tahun Akademik**: 2024/2025 Semester 1
- **Icon**: ğŸŒ

### Semester 2 (Januari - Juni)  
- **Periode**: 1 Januari - 30 Juni
- **Tahun Akademik**: 2024/2025 Semester 2
- **Icon**: â„ï¸

## ğŸ›ï¸ Konfigurasi

### Database Schema
```prisma
model TahunAjaran {
  id            Int      @id @default(autoincrement())
  tahunMulai    Int      // 2024
  tahunSelesai  Int      // 2025
  semester      Semester // S1 atau S2
  namaLengkap   String   // "2024/2025 Semester 1"
  tanggalMulai  DateTime
  tanggalSelesai DateTime
  isActive      Boolean  @default(false)
  
  // Relations
  templateUjian    TemplateUjian[]
  templateRaport   TemplateRaport[]
  ujianSantri      UjianSantri[]
  raportSantri     RaportSantri[]
}

enum Semester {
  S1
  S2
}
```

## ğŸ”„ Flow Data

1. **Auto-Detection**: System otomatis detect tahun akademik saat ini berdasarkan tanggal
2. **Auto-Create**: Jika belum ada, system buat tahun akademik otomatis
3. **Auto-Inject**: Semua data baru otomatis dapat tahun akademik ID
4. **Filter**: Data dapat difilter berdasarkan tahun akademik
5. **Archive**: Data lama tetap tersimpan per tahun akademik

## ğŸ¯ Benefits

### Untuk Admin
- âœ… Manajemen tahun akademik yang mudah
- âœ… Auto-generate untuk efisiensi
- âœ… Statistik data per tahun akademik
- âœ… Konsistensi data across system

### Untuk User
- âœ… Data tersusun rapi per semester
- âœ… Filter data berdasarkan tahun
- âœ… Historical data tetap accessible
- âœ… Seamless experience

### Untuk Developer
- âœ… Utilities yang reusable
- âœ… Hooks untuk React components
- âœ… Middleware untuk auto-injection
- âœ… Type-safe dengan TypeScript

## ğŸ§ª Testing

Jalankan test script:
```bash
node scripts/test-tahun-akademik-system.js
```

Test coverage:
- âœ… Auto-generate preview
- âœ… Active tahun akademik detection
- âœ… Utility functions
- âœ… Date-based semester calculation

## ğŸ“ˆ Monitoring

Dashboard menampilkan:
- Total tahun akademik
- Tahun akademik aktif saat ini
- Jumlah data per tahun akademik
- Status sistem tahun akademik

---

**ğŸ“ AR-Hafalan Tahun Akademik System v2.0**  
*Sistem manajemen tahun akademik otomatis untuk platform hafalan Quran digital*